<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#1a1a2e">
    <title>Salaam Rides - Book Your Ride Now</title>
    <!-- Favicon -->
    <link rel="icon" href="data:,">
    <!-- CSS -->
    <link rel="stylesheet" href="styles.css">
    <style>
        /* Inline critical styles for mobile layout */
        /* Desktop/Mobile visibility classes */
        .desktop-only {
            display: block;
        }
        
        .mobile-only {
            display: none;
        }
        
        /* Location input container styling */
        .location-input-container {
            display: flex;
            gap: 10px;
            align-items: center;
            width: 100%;
        }
        
        .location-input {
            flex: 1;
            position: relative;
        }
        
        /* Mobile location button styling */
        #current-location {
            padding: 8px 12px;
            font-size: 0.9rem;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        #current-location svg {
            margin-right: 2px;
        }
        
        /* Media queries for mobile */
        @media (max-width: 768px) {
            /* Switch visibility for desktop/mobile elements */
            .desktop-only {
                display: none !important;
            }
            
            .mobile-only {
                display: flex !important;
            }
            
            /* Hide map on mobile */
            .map-container {
                display: none !important;
            }
            
            /* Ensure form is full width */
            .booking-form {
                width: 100%;
            }
            
            /* Style the location input container for mobile */
            .location-input-container {
                flex-direction: row;
                gap: 8px;
            }
        }
        
        /* For very small screens */
        @media (max-width: 480px) {
            #current-location {
                padding: 8px 10px;
                font-size: 0.8rem;
            }
            
            #current-location svg {
                width: 14px;
                height: 14px;
            }
        }
    </style>
</head>
<body>
    <!-- Header Section -->
    <header>
        <div class="container">
            <nav>
                <div class="logo animate-fadeIn">
                    <svg width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10"></circle>
                        <polygon points="16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76"></polygon>
                    </svg>
                    <h1>Salaam Rides</h1>
                </div>
                <div class="hamburger">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
                <ul class="nav-links">
                    <li class="animate-fadeIn delay-100"><a href="#book">Book a Ride</a></li>
                    <li class="animate-fadeIn delay-200"><a href="#features">Features</a></li>
                    <li class="animate-fadeIn delay-300"><a href="#about">About Us</a></li>
                    <li class="animate-fadeIn delay-400"><a href="#contact">Contact</a></li>
                    <li class="animate-fadeIn delay-500"><a href="#" id="account-link">My Account</a></li>
                </ul>
                <div class="account-buttons animate-fadeIn delay-500">
                    <button id="login-btn" class="btn btn-outline">Login</button>
                    <a href="signup.html" class="btn btn-primary">Sign Up</a>
                </div>
                <a href="#book" class="btn btn-primary animate-fadeIn delay-500 book-now-btn">Book Now</a>
            </nav>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero">
        <div class="container">
            <div class="hero-content">
                <h2>Your Reliable Ride in Guyana, Anytime, Anywhere</h2>
                <p>Experience safe, comfortable and affordable rides with Salaam Rides across West Bank Demerara and beyond. Just a few clicks away from your next journey.</p>
                <a href="#book" class="btn btn-secondary">Book Your Ride Now</a>
            </div>
        </div>
    </section>

    <!-- Book Ride Section -->
    <section class="book-ride" id="book">
        <div class="container">
            <h2 class="section-title">Book Your Ride</h2>
            <div class="booking-container">
                <!-- Map container - will be hidden on mobile -->
                <div class="map-container desktop-only">
                    <div id="map"></div>
                    <div id="map-fallback" class="map-placeholder">
                        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="#888" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                            <circle cx="12" cy="10" r="3"></circle>
                        </svg>
                        <p>Loading map...</p>
                        <p>Please ensure location services are enabled</p>
                    </div>
                    <div class="map-controls">
                        <button class="btn btn-secondary" id="map-current-location">Use Current Location</button>
                        <div class="desktop-location-message">Please enter your address manually for better accuracy.</div>
                    </div>
                </div>
                
                <!-- Booking form -->
                <div class="booking-form">
                    <h3 class="form-title">Enter Your Details</h3>
                    <div class="booking-tabs">
                        <button class="booking-tab active" data-tab="now">Book Now</button>
                        <button class="booking-tab" data-tab="schedule">Schedule Ride</button>
                    </div>
                    <form id="ride-form">
                        <div class="form-group">
                            <label for="pickup">Pickup Location</label>
                            <div class="location-input-container">
                                <div class="location-input">
                                    <input type="text" id="pickup" placeholder="Enter pickup location" required>
                                    <button type="button" class="location-btn" id="pickup-btn">
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                                            <circle cx="12" cy="10" r="3"></circle>
                                        </svg>
                                    </button>
                                </div>
                                <!-- Current location button for mobile -->
                                <button type="button" class="btn btn-secondary mobile-only" id="current-location">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <circle cx="12" cy="12" r="10"></circle>
                                        <circle cx="12" cy="12" r="3"></circle>
                                    </svg>
                                    Use My Location
                                </button>
                            </div>
                            <div id="pickup-autocomplete-container"></div>
                        </div>
                        <div class="form-group">
                            <label for="destination">Destination</label>
                            <div class="location-input">
                                <input type="text" id="destination" placeholder="Enter destination">
                                <button type="button" class="location-btn" id="destination-btn">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                                        <circle cx="12" cy="10" r="3"></circle>
                                    </svg>
                                </button>
                            </div>
                            <div id="destination-autocomplete-container"></div>
                        </div>
                        
                        <!-- Schedule Ride Options - Initially Hidden -->
                        <div id="schedule-options" class="schedule-options" style="display: none;">
                            <div class="form-group">
                                <label for="ride-date">Date</label>
                                <input type="date" id="ride-date" min="" required>
                            </div>
                            <div class="form-group">
                                <label for="ride-time">Time</label>
                                <input type="time" id="ride-time" required>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="name">Your Name</label>
                            <input type="text" id="name" placeholder="Enter your full name" required>
                        </div>
                        <div class="form-group">
                            <label for="phone">Phone Number</label>
                            <input type="tel" id="phone" placeholder="Enter your phone number" required>
                        </div>
                        <div class="form-group">
                            <label for="car-type">Car Type</label>
                            <select id="car-type" required>
                                <option value="">Select car type</option>
                                <option value="economy">Economy</option>
                                <option value="standard">Standard</option>
                                <option value="premium">Premium</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="notes">Special Notes (Optional)</label>
                            <input type="text" id="notes" placeholder="Any special requirements?">
                        </div>
                        <button type="submit" class="btn btn-primary" style="width: 100%;" id="ride-submit-btn">Request Ride</button>
                    </form>
                </div>
            </div>
        </div>
    </section>

    <!-- Features Section -->
    <section class="features" id="features">
        <div class="container">
            <h2 class="section-title animate-slideUp">Why Choose Salaam Rides</h2>
            <div class="features-container">
                <div class="feature-card animate-slideUp delay-100">
                    <div class="feature-icon">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="10"></circle>
                            <polyline points="12 6 12 12 16 14"></polyline>
                        </svg>
                    </div>
                    <h3>24/7 Service</h3>
                    <p>We're available round the clock. Book a ride anytime, day or night, and we'll be there for you.</p>
                </div>
                <div class="feature-card animate-slideUp delay-200">
                    <div class="feature-icon">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                        </svg>
                    </div>
                    <h3>Safe & Secure</h3>
                    <p>All our drivers are verified and trained. Your safety is our top priority during every ride.</p>
                </div>
                <div class="feature-card animate-slideUp delay-300">
                    <div class="feature-icon">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="12" y1="1" x2="12" y2="23"></line>
                            <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                        </svg>
                    </div>
                    <h3>Affordable Rates</h3>
                    <p>Enjoy competitive pricing with no hidden charges. Get the best value for your money with every ride.</p>
                </div>
                <div class="feature-card animate-slideUp delay-400">
                    <div class="feature-icon">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                            <line x1="16" y1="2" x2="16" y2="6"></line>
                            <line x1="8" y1="2" x2="8" y2="6"></line>
                            <line x1="3" y1="10" x2="21" y2="10"></line>
                        </svg>
                    </div>
                    <h3>Easy Scheduling</h3>
                    <p>Plan your trips in advance and schedule rides for later. We'll be there exactly when you need us.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- About Section and rest of content remains the same -->
    <!-- ... -->

    <!-- JavaScript -->
    <script src="script.js"></script>
    
    <!-- Updated Google Maps API with callback -->
    <script>
        // Debug information function
        function debugMapInit() {
            console.log("Map debug information:");
            // Check DOM elements
            const mapElement = document.getElementById('map');
            console.log('Map element exists:', !!mapElement);
            if (mapElement) {
                console.log('Map element dimensions:', mapElement.offsetWidth, 'x', mapElement.offsetHeight);
                const styles = window.getComputedStyle(mapElement);
                console.log('Map visibility:', styles.display, styles.visibility);
            }
            
            const pickupInput = document.getElementById('pickup');
            const destInput = document.getElementById('destination');
            console.log('Pickup input exists:', !!pickupInput);
            console.log('Destination input exists:', !!destInput);
            
            // Check if Google Maps API is loaded
            console.log('Google Maps API loaded:', typeof google !== 'undefined');
            if (typeof google !== 'undefined') {
                console.log('Maps object available:', typeof google.maps !== 'undefined');
                console.log('Places API available:', typeof google.maps.places !== 'undefined');
            }
        }
        
        // Create a global initMap function that will be called when Google Maps API loads
        window.initMap = function() {
            console.log("Google Maps initialization started");
            debugMapInit();
            
            // Only initialize map on desktop
            if (!isMobileDevice()) {
                // Make sure DOM is fully loaded before trying to access map element
                if (document.readyState === "complete" || document.readyState === "interactive") {
                    setTimeout(initializeMap, 100); // Small delay to ensure DOM is ready
                } else {
                    document.addEventListener("DOMContentLoaded", function() {
                        setTimeout(initializeMap, 100);
                    });
                }
            } else {
                console.log("Mobile device detected, skipping map initialization");
            }
        };
        
        // Function to check if device is mobile
        function isMobileDevice() {
            // Check if the device is mobile based on screen size or user agent
            const isMobileBySize = window.innerWidth <= 768;
            const isMobileByAgent = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            
            return isMobileBySize || isMobileByAgent;
        }
        
        // Function to get location error messages
        function getLocationErrorMessage(error) {
            switch(error.code) {
                case error.PERMISSION_DENIED:
                    return "Location permission denied. Please check your browser settings.";
                case error.POSITION_UNAVAILABLE:
                    return "Location information is unavailable.";
                case error.TIMEOUT:
                    return "Location request timed out.";
                default:
                    return "An unknown location error occurred.";
            }
        }
        
        // Actual map initialization function with fixes
        function initializeMap() {
            try {
                console.log("Initializing map implementation...");
                
                // Check if the map element exists
                const mapElement = document.getElementById('map');
                if (!mapElement) {
                    console.error('Map element not found');
                    showMapError('Map element not found. Please refresh the page.');
                    return;
                }
                
                // Only proceed if Google Maps API is loaded
                if (typeof google === 'undefined' || typeof google.maps === 'undefined') {
                    console.error('Google Maps API not loaded');
                    showMapError('Google Maps API is not available. Please check your internet connection and try again.');
                    return;
                }
                
                // Default location (Guyana - West Bank Demerara area)
                const defaultLocation = { lat: 6.8057, lng: -58.1553 };
                
                // Improved map options - particularly for mobile devices
                const mapOptions = {
                    center: defaultLocation,
                    zoom: 13,
                    mapTypeControl: false,
                    streetViewControl: false,
                    fullscreenControl: false,
                    zoomControl: true,
                    gestureHandling: 'greedy', // Better touch handling
                    disableDefaultUI: false
                };
                
                // Create a new map centered at the default location with improved options
                window.map = new google.maps.Map(mapElement, mapOptions);
                
                // Hide the fallback placeholder
                const fallback = document.getElementById('map-fallback');
                if (fallback) {
                    fallback.style.display = 'none';
                }
                
                // Initialize geocoder for address lookups
                window.geocoder = new google.maps.Geocoder();
                
                // Initialize directions service for route planning
                window.directionsService = new google.maps.DirectionsService();
                window.directionsRenderer = new google.maps.DirectionsRenderer({
                    map: window.map,
                    suppressMarkers: true
                });
                
                // Add a click event listener to the map
                window.map.addListener('click', function(event) {
                    placeMarker(event.latLng);
                });
                
                // Setup new autocomplete or fallback to legacy
                setupPlaceAutocomplete();
                
                console.log('Map initialization completed successfully');
            } catch (error) {
                console.error('Error initializing map:', error);
                showMapError('An error occurred while initializing the map. Please refresh the page.');
            }
        }
        
        // Updated getCurrentLocation function to work without a visible map on mobile
        function getCurrentLocation() {
            // Determine which button was clicked
            const mobileLocationBtn = document.getElementById('current-location');
            const desktopLocationBtn = document.getElementById('map-current-location');
            const pickupInput = document.getElementById('pickup');
            
            // Determine if called from mobile
            const isMobile = isMobileDevice();
            
            // Get the appropriate button based on device
            const currentLocationBtn = isMobile ? mobileLocationBtn : desktopLocationBtn;
            
            if (!navigator.geolocation) {
                alert("Geolocation is not supported by this browser. Please enter your location manually.");
                return;
            }
            
            // Update selected mode
            window.selectedMode = 'pickup';
            
            if (currentLocationBtn) {
                currentLocationBtn.disabled = true;
                // Different loading state based on button type
                if (isMobile) {
                    currentLocationBtn.innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle></svg> Loading...';
                } else {
                    currentLocationBtn.innerHTML = '<span class="btn-loading"></span>Locating...';
                }
            }
            
            if (pickupInput) {
                pickupInput.value = "Getting your location...";
            }
            
            navigator.geolocation.getCurrentPosition(
                // Success callback
                (position) => {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    const accuracy = position.coords.accuracy; // Accuracy in meters
                    
                    console.log(`Location obtained with accuracy: ${accuracy} meters`);
                    
                    if (accuracy > 5000) {
                        console.warn(`Poor location accuracy: ${accuracy} meters`);
                        showNotification(`Location found but with low accuracy (${Math.round(accuracy/1000)} km). Your position may not be precise.`, "warning");
                    }
                    
                    const currentLocation = new google.maps.LatLng(lat, lng);
                    
                    // Only center map if it's visible (desktop)
                    if (!isMobile && window.map) {
                        window.map.setCenter(currentLocation);
                        // Adjust zoom based on accuracy
                        const zoomLevel = accuracy < 100 ? 18 : 
                                        accuracy < 500 ? 17 : 
                                        accuracy < 1000 ? 16 : 
                                        accuracy < 5000 ? 15 : 13;
                        window.map.setZoom(zoomLevel);
                    }
                    
                    // Use geocoder to get address
                    if (window.geocoder) {
                        window.geocoder.geocode({ 'location': currentLocation }, function(results, status) {
                            if (status === 'OK' && results[0]) {
                                // Get the most accurate result
                                let bestResult = results[0];
                                
                                // Try to find a result with a street address
                                for (let i = 0; i < results.length; i++) {
                                    if (results[i].types.includes('street_address') || 
                                        results[i].types.includes('premise') ||
                                        results[i].types.includes('route')) {
                                        bestResult = results[i];
                                        break;
                                    }
                                }
                                
                                // Update pickup input with the formatted address
                                if (pickupInput) {
                                    pickupInput.value = bestResult.formatted_address;
                                    
                                    // Add a small animation to the input
                                    pickupInput.style.backgroundColor = 'rgba(0, 184, 148, 0.2)';
                                    setTimeout(() => {
                                        pickupInput.style.transition = 'background-color 0.5s ease';
                                        pickupInput.style.backgroundColor = '';
                                    }, 1000);
                                }
                            } else {
                                console.warn('No results found for geocoding');
                                if (pickupInput) {
                                    pickupInput.value = `Location (${lat.toFixed(6)}, ${lng.toFixed(6)})`;
                                }
                            }
                        });
                    }
                    
                    // Only place marker if map is visible (desktop)
                    if (!isMobile && window.map) {
                        placeMarker(currentLocation, 'pickup');
                    }
                    
                    // Save the location in case we need it later
                    window.lastLocation = currentLocation;
                    
                    // Reset button
                    if (currentLocationBtn) {
                        currentLocationBtn.disabled = false;
                        if (isMobile) {
                            currentLocationBtn.innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><circle cx="12" cy="12" r="3"></circle></svg> Use My Location';
                        } else {
                            currentLocationBtn.innerHTML = 'Use Current Location';
                        }
                    }
                },
                // Error callback
                (error) => {
                    console.warn('Geolocation error:', error.code, error.message);
                    
                    // Show appropriate error message
                    const errorMsg = getLocationErrorMessage(error);
                    showNotification(errorMsg, "error");
                    
                    // Reset inputs and button
                    if (pickupInput) {
                        pickupInput.value = "";
                    }
                    
                    // Reset button
                    if (currentLocationBtn) {
                        currentLocationBtn.disabled = false;
                        if (isMobile) {
                            currentLocationBtn.innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><circle cx="12" cy="12" r="3"></circle></svg> Use My Location';
                        } else {
                            currentLocationBtn.innerHTML = 'Use Current Location';
                        }
                    }
                },
                // Options
                {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 0
                }
            );
        }
        
        // Helper function to show map error
        function showMapError(message) {
            const mapElement = document.getElementById('map');
            const fallback = document.getElementById('map-fallback');
            
            if (fallback) {
                fallback.innerHTML = `
                    <div style="text-align: center; padding: 20px; color: #d32f2f;">
                        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="#d32f2f" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="10"></circle>
                            <line x1="12" y1="8" x2="12" y2="12"></line>
                            <line x1="12" y1="16" x2="12.01" y2="16"></line>
                        </svg>
                        <h3>Map Error</h3>
                        <p>${message}</p>
                    </div>
                `;
                fallback.style.display = 'flex';
            } else if (mapElement) {
                mapElement.innerHTML = `
                    <div style="text-align: center; padding: 20px; color: #d32f2f;">
                        <h3>Map Error</h3>
                        <p>${message}</p>
                    </div>
                `;
            }
        }
        
        // Function to place a marker on the map - only used on desktop
        function placeMarker(location, type = window.selectedMode) {
            if (!window.map || !google) return;

            // If this is a LatLng object, convert it to a plain object
            let position;
            if (location instanceof google.maps.LatLng) {
                position = {
                    lat: location.lat(),
                    lng: location.lng()
                };
            } else {
                position = location;
            }
            
            // Remove existing marker of the same type
            window.markers = window.markers || [];
            window.markers = window.markers.filter(marker => {
                if (marker.type === type) {
                    marker.setMap(null);
                    return false;
                }
                return true;
            });
            
            // Create a new marker
            const marker = new google.maps.Marker({
                position: position,
                map: window.map,
                animation: google.maps.Animation.DROP,
                icon: type === 'pickup' ? 
                    'https://maps.google.com/mapfiles/ms/icons/green-dot.png' : 
                    'https://maps.google.com/mapfiles/ms/icons/red-dot.png'
            });
            
            // Add the type property to the marker
            marker.type = type;
            
            // Add the marker to our array
            window.markers.push(marker);
            
            // Update the input field with the address
            window.geocoder.geocode({ 'location': position }, function(results, status) {
                if (status === 'OK') {
                    if (results[0]) {
                        if (type === 'pickup') {
                            document.getElementById('pickup').value = results[0].formatted_address;
                        } else {
                            document.getElementById('destination').value = results[0].formatted_address;
                        }
                        
                        // Calculate and display the route if both markers are present
                        calculateAndDisplayRoute();
                    }
                }
            });
        }
        
        // Set up event listeners for mobile/desktop location buttons
        document.addEventListener('DOMContentLoaded', function() {
            const mobileLocationBtn = document.getElementById('current-location');
            const desktopLocationBtn = document.getElementById('map-current-location');
            
            if (mobileLocationBtn) {
                mobileLocationBtn.addEventListener('click', getCurrentLocation);
            }
            
            if (desktopLocationBtn) {
                desktopLocationBtn.addEventListener('click', getCurrentLocation);
            }
            
            // Map API loading is handled differently now
            // Only load map on desktop
            if (!isMobileDevice()) {
                loadGoogleMapsAPI();
            } else {
                // Still need to load the API for geocoding on mobile
                loadGoogleMapsAPIForMobile();
            }
        });
        
        // Load Google Maps API with fixed loading for desktop
        function loadGoogleMapsAPI() {
            const script = document.createElement('script');
            
            // Add error handler
            script.onerror = function() {
                console.error("Failed to load Google Maps API");
                showMapError("Failed to load Google Maps API. Please check your internet connection and try again.");
            };
            
            // Add the script with proper async loading
            script.src = "https://maps.googleapis.com/maps/api/js?key=AIzaSyA-6uXAa6MkIMwlYYwMIVBq5s3T0aTh0EI&libraries=places&callback=initMap&loading=async";
            script.async = true;
            script.defer = true;
            document.head.appendChild(script);
        }
        
        // Load Google Maps API for geocoding only on mobile
        function loadGoogleMapsAPIForMobile() {
            const script = document.createElement('script');
            
            // Add error handler
            script.onerror = function() {
                console.error("Failed to load Google Maps API for mobile");
                showNotification("Failed to load location services. Please check your internet connection.", "error");
            };
            
            // Add the script with proper async loading - no callback
            script.src = "https://maps.googleapis.com/maps/api/js?key=AIzaSyA-6uXAa6MkIMwlYYwMIVBq5s3T0aTh0EI&libraries=places";
            script.async = true;
            script.defer = true;
            document.head.appendChild(script);
            
            // Initialize geocoder when script loads
            script.onload = function() {
                window.geocoder = new google.maps.Geocoder();
                console.log("Google Maps API loaded for mobile geocoding");
            };
        }
        
        // Show notification function
        function showNotification(message, type = 'info') {
            // Create notification element if not exists
            let notification = document.querySelector('.map-notification');
            
            if (!notification) {
                notification = document.createElement('div');
                notification.className = `map-notification ${type}`;
                document.body.appendChild(notification);
            } else {
                notification.className = `map-notification ${type}`;
            }
            
            // Set content
            notification.innerHTML = `
                <div class="notification-icon">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        ${type === 'success' 
                          ? '<path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline>'
                          : '<circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line>'}
                    </svg>
                </div>
                <div class="notification-message">${message}</div>
                <button class="notification-close">×</button>
            `;
            
            // Show notification
            notification.style.display = 'flex';
            
            // Add notification styles if they don't exist
            if (!document.getElementById('notification-styles')) {
                const style = document.createElement('style');
                style.id = 'notification-styles';
                style.textContent = `
                    .map-notification {
                        position: fixed;
                        bottom: 20px;
                        left: 20px;
                        right: 20px;
                        display: none;
                        align-items: center;
                        gap: 10px;
                        background-color: var(--card-bg);
                        color: var(--text-color);
                        padding: 15px 20px;
                        border-radius: 8px;
                        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
                        z-index: 1000;
                        max-width: calc(100% - 40px);
                        margin: 0 auto;
                        transform: translateY(20px);
                        opacity: 0;
                        transition: transform 0.3s ease, opacity 0.3s ease;
                    }
                    
                    .map-notification.show {
                        transform: translateY(0);
                        opacity: 1;
                    }
                    
                    .map-notification.success {
                        border-left: 4px solid var(--accent-color);
                    }
                    
                    .map-notification.error {
                        border-left: 4px solid #e74c3c;
                    }
                    
                    .map-notification.warning {
                        border-left: 4px solid #f39c12;
                    }
                    
                    .map-notification.info {
                        border-left: 4px solid #3498db;
                    }
                    
                    .notification-close {
                        background: none;
                        border: none;
                        color: var(--muted-text);
                        font-size: 20px;
                        cursor: pointer;
                        padding: 0;
                        margin-left: auto;
                    }
                    
                    .notification-close:hover {
                        color: var(--text-color);
                    }
                    
                    .notification-message {
                        flex: 1;
                    }
                    
                    @media (min-width: 768px) {
                        .map-notification {
                            max-width: 400px;
                            left: auto;
                        }
                    }
                `;
                document.head.appendChild(style);
            }
            
            // Set timeout to show
            setTimeout(() => {
                notification.classList.add('show');
            }, 10);
            
            // Add close event
            const closeBtn = notification.querySelector('.notification-close');
            if (closeBtn) {
                closeBtn.addEventListener('click', () => {
                    notification.classList.remove('show');
                    setTimeout(() => {
                        notification.style.display = 'none';
                    }, 300);
                });
            }
            
            // Auto hide after 5 seconds
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    notification.style.display = 'none';
                }, 300);
            }, 5000);
        }
    </script>
</body>
</html>
